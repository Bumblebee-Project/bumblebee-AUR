# Maintainer: Samsagax <samsagax@gmail.com>

pkgname=bumblebee
pkgver=2.4.1
pkgrel=4
pkgdesc="Stable branch of Bumblebee. Optimus Support for Linux Through VirtualGL."
arch=('i686' 'x86_64')
depends=('xorg-utils' 'virtualgl>=2.2.90' 'nvidia-utils-bumblebee')
if [ "$CARCH" = "x86_64" ]; then
     optdepends=('lib32-virtualgl: run 32bit applications with optirun'
                'lib32-nvidia-utils-bumblebee: run 32bit applications with optirun')
fi
optdepends[${#optdepends[@]}]='acpi_call: turn on/off discrete card (unstable)'
url="https://github.com/Bumblebee-Project/Bumblebee"
license=("GPL3")
install=('bumblebee.install')
conflicts=('bumblebee-nouveau')
provides=('bumblebee')
source=("https://github.com/downloads/Bumblebee-Project/Bumblebee/$pkgname-$pkgver.tar.gz" 'bumblebee.handler.archlinux')
md5sums=('cda3f529b07461cc5abcea58a50df5cc'
         '339b9af9212edcc4a4e11f22397ef50c')

_temp_dir="$srcdir/install-temp"

build() {
    cd "$srcdir/$pkgname-$pkgver"
    mkdir -p $_temp_dir
    ./install --dest-dir=$_temp_dir \
    --driver=nouveau,nvidia \
    --actions=build,install
    install -D -m755 $srcdir/bumblebee.handler.archlinux $_temp_dir/etc/rc.d/bumblebee
}

package() {
    cd "$_temp_dir"
    cp -a etc usr "$pkgdir"
}
